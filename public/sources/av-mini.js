!function(t){t.AV=t.AV||{},t.AV.VERSION="js0.2.7"}(this),function(){var t=this,e=t._,i={},n=Array.prototype,r=Object.prototype,s=Function.prototype,o=n.push,a=n.slice,l=n.concat,c=r.toString,d=r.hasOwnProperty,u=n.forEach,h=n.map,f=n.reduce,p=n.reduceRight,g=n.filter,_=n.every,v=n.some,m=n.indexOf,w=n.lastIndexOf,x=Array.isArray,b=Object.keys,I=s.bind,y=function(t){return t instanceof y?t:this instanceof y?(this._wrapped=t,void 0):new y(t)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=y),exports._=y):t._=y,y.VERSION="1.4.4";var C=y.each=y.forEach=function(t,e,n){if(null!=t)if(u&&t.forEach===u)t.forEach(e,n);else if(t.length===+t.length){for(var r=0,s=t.length;s>r;r++)if(e.call(n,t[r],r,t)===i)return}else for(var o in t)if(y.has(t,o)&&e.call(n,t[o],o,t)===i)return};y.map=y.collect=function(t,e,i){var n=[];return null==t?n:h&&t.map===h?t.map(e,i):(C(t,function(t,r,s){n[n.length]=e.call(i,t,r,s)}),n)};var S="Reduce of empty array with no initial value";y.reduce=y.foldl=y.inject=function(t,e,i,n){var r=arguments.length>2;if(null==t&&(t=[]),f&&t.reduce===f)return n&&(e=y.bind(e,n)),r?t.reduce(e,i):t.reduce(e);if(C(t,function(t,s,o){r?i=e.call(n,i,t,s,o):(i=t,r=!0)}),!r)throw new TypeError(S);return i},y.reduceRight=y.foldr=function(t,e,i,n){var r=arguments.length>2;if(null==t&&(t=[]),p&&t.reduceRight===p)return n&&(e=y.bind(e,n)),r?t.reduceRight(e,i):t.reduceRight(e);var s=t.length;if(s!==+s){var o=y.keys(t);s=o.length}if(C(t,function(a,l,c){l=o?o[--s]:--s,r?i=e.call(n,i,t[l],l,c):(i=t[l],r=!0)}),!r)throw new TypeError(S);return i},y.find=y.detect=function(t,e,i){var n;return P(t,function(t,r,s){return e.call(i,t,r,s)?(n=t,!0):void 0}),n},y.filter=y.select=function(t,e,i){var n=[];return null==t?n:g&&t.filter===g?t.filter(e,i):(C(t,function(t,r,s){e.call(i,t,r,s)&&(n[n.length]=t)}),n)},y.reject=function(t,e,i){return y.filter(t,function(t,n,r){return!e.call(i,t,n,r)},i)},y.every=y.all=function(t,e,n){e||(e=y.identity);var r=!0;return null==t?r:_&&t.every===_?t.every(e,n):(C(t,function(t,s,o){return(r=r&&e.call(n,t,s,o))?void 0:i}),!!r)};var P=y.some=y.any=function(t,e,n){e||(e=y.identity);var r=!1;return null==t?r:v&&t.some===v?t.some(e,n):(C(t,function(t,s,o){return r||(r=e.call(n,t,s,o))?i:void 0}),!!r)};y.contains=y.include=function(t,e){return null==t?!1:m&&t.indexOf===m?-1!=t.indexOf(e):P(t,function(t){return t===e})},y.invoke=function(t,e){var i=a.call(arguments,2),n=y.isFunction(e);return y.map(t,function(t){return(n?e:t[e]).apply(t,i)})},y.pluck=function(t,e){return y.map(t,function(t){return t[e]})},y.where=function(t,e,i){return y.isEmpty(e)?i?null:[]:y[i?"find":"filter"](t,function(t){for(var i in e)if(e[i]!==t[i])return!1;return!0})},y.findWhere=function(t,e){return y.where(t,e,!0)},y.max=function(t,e,i){if(!e&&y.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.max.apply(Math,t);if(!e&&y.isEmpty(t))return-1/0;var n={computed:-1/0,value:-1/0};return C(t,function(t,r,s){var o=e?e.call(i,t,r,s):t;o>=n.computed&&(n={value:t,computed:o})}),n.value},y.min=function(t,e,i){if(!e&&y.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.min.apply(Math,t);if(!e&&y.isEmpty(t))return 1/0;var n={computed:1/0,value:1/0};return C(t,function(t,r,s){var o=e?e.call(i,t,r,s):t;o<n.computed&&(n={value:t,computed:o})}),n.value},y.shuffle=function(t){var e,i=0,n=[];return C(t,function(t){e=y.random(i++),n[i-1]=n[e],n[e]=t}),n};var O=function(t){return y.isFunction(t)?t:function(e){return e[t]}};y.sortBy=function(t,e,i){var n=O(e);return y.pluck(y.map(t,function(t,e,r){return{value:t,index:e,criteria:n.call(i,t,e,r)}}).sort(function(t,e){var i=t.criteria,n=e.criteria;if(i!==n){if(i>n||void 0===i)return 1;if(n>i||void 0===n)return-1}return t.index<e.index?-1:1}),"value")};var R=function(t,e,i,n){var r={},s=O(e||y.identity);return C(t,function(e,o){var a=s.call(i,e,o,t);n(r,a,e)}),r};y.groupBy=function(t,e,i){return R(t,e,i,function(t,e,i){(y.has(t,e)?t[e]:t[e]=[]).push(i)})},y.countBy=function(t,e,i){return R(t,e,i,function(t,e){y.has(t,e)||(t[e]=0),t[e]++})},y.sortedIndex=function(t,e,i,n){i=null==i?y.identity:O(i);for(var r=i.call(n,e),s=0,o=t.length;o>s;){var a=s+o>>>1;i.call(n,t[a])<r?s=a+1:o=a}return s},y.toArray=function(t){return t?y.isArray(t)?a.call(t):t.length===+t.length?y.map(t,y.identity):y.values(t):[]},y.size=function(t){return null==t?0:t.length===+t.length?t.length:y.keys(t).length},y.first=y.head=y.take=function(t,e,i){return null==t?void 0:null==e||i?t[0]:a.call(t,0,e)},y.initial=function(t,e,i){return a.call(t,0,t.length-(null==e||i?1:e))},y.last=function(t,e,i){return null==t?void 0:null==e||i?t[t.length-1]:a.call(t,Math.max(t.length-e,0))},y.rest=y.tail=y.drop=function(t,e,i){return a.call(t,null==e||i?1:e)},y.compact=function(t){return y.filter(t,y.identity)};var A=function(t,e,i){return C(t,function(t){y.isArray(t)?e?o.apply(i,t):A(t,e,i):i.push(t)}),i};y.flatten=function(t,e){return A(t,e,[])},y.without=function(t){return y.difference(t,a.call(arguments,1))},y.uniq=y.unique=function(t,e,i,n){y.isFunction(e)&&(n=i,i=e,e=!1);var r=i?y.map(t,i,n):t,s=[],o=[];return C(r,function(i,n){(e?n&&o[o.length-1]===i:y.contains(o,i))||(o.push(i),s.push(t[n]))}),s},y.union=function(){return y.uniq(l.apply(n,arguments))},y.intersection=function(t){var e=a.call(arguments,1);return y.filter(y.uniq(t),function(t){return y.every(e,function(e){return y.indexOf(e,t)>=0})})},y.difference=function(t){var e=l.apply(n,a.call(arguments,1));return y.filter(t,function(t){return!y.contains(e,t)})},y.zip=function(){for(var t=a.call(arguments),e=y.max(y.pluck(t,"length")),i=new Array(e),n=0;e>n;n++)i[n]=y.pluck(t,""+n);return i},y.object=function(t,e){if(null==t)return{};for(var i={},n=0,r=t.length;r>n;n++)e?i[t[n]]=e[n]:i[t[n][0]]=t[n][1];return i},y.indexOf=function(t,e,i){if(null==t)return-1;var n=0,r=t.length;if(i){if("number"!=typeof i)return n=y.sortedIndex(t,e),t[n]===e?n:-1;n=0>i?Math.max(0,r+i):i}if(m&&t.indexOf===m)return t.indexOf(e,i);for(;r>n;n++)if(t[n]===e)return n;return-1},y.lastIndexOf=function(t,e,i){if(null==t)return-1;var n=null!=i;if(w&&t.lastIndexOf===w)return n?t.lastIndexOf(e,i):t.lastIndexOf(e);for(var r=n?i:t.length;r--;)if(t[r]===e)return r;return-1},y.range=function(t,e,i){arguments.length<=1&&(e=t||0,t=0),i=arguments[2]||1;for(var n=Math.max(Math.ceil((e-t)/i),0),r=0,s=new Array(n);n>r;)s[r++]=t,t+=i;return s},y.bind=function(t,e){if(t.bind===I&&I)return I.apply(t,a.call(arguments,1));var i=a.call(arguments,2);return function(){return t.apply(e,i.concat(a.call(arguments)))}},y.partial=function(t){var e=a.call(arguments,1);return function(){return t.apply(this,e.concat(a.call(arguments)))}},y.bindAll=function(t){var e=a.call(arguments,1);return 0===e.length&&(e=y.functions(t)),C(e,function(e){t[e]=y.bind(t[e],t)}),t},y.memoize=function(t,e){var i={};return e||(e=y.identity),function(){var n=e.apply(this,arguments);return y.has(i,n)?i[n]:i[n]=t.apply(this,arguments)}},y.delay=function(t,e){var i=a.call(arguments,2);return setTimeout(function(){return t.apply(null,i)},e)},y.defer=function(t){return y.delay.apply(y,[t,1].concat(a.call(arguments,1)))},y.throttle=function(t,e){var i,n,r,s,o=0,a=function(){o=new Date,r=null,s=t.apply(i,n)};return function(){var l=new Date,c=e-(l-o);return i=this,n=arguments,0>=c?(clearTimeout(r),r=null,o=l,s=t.apply(i,n)):r||(r=setTimeout(a,c)),s}},y.debounce=function(t,e,i){var n,r;return function(){var s=this,o=arguments,a=function(){n=null,i||(r=t.apply(s,o))},l=i&&!n;return clearTimeout(n),n=setTimeout(a,e),l&&(r=t.apply(s,o)),r}},y.once=function(t){var e,i=!1;return function(){return i?e:(i=!0,e=t.apply(this,arguments),t=null,e)}},y.wrap=function(t,e){return function(){var i=[t];return o.apply(i,arguments),e.apply(this,i)}},y.compose=function(){var t=arguments;return function(){for(var e=arguments,i=t.length-1;i>=0;i--)e=[t[i].apply(this,e)];return e[0]}},y.after=function(t,e){return 0>=t?e():function(){return--t<1?e.apply(this,arguments):void 0}},y.keys=b||function(t){if(t!==Object(t))throw new TypeError("Invalid object");var e=[];for(var i in t)y.has(t,i)&&(e[e.length]=i);return e},y.values=function(t){var e=[];for(var i in t)y.has(t,i)&&e.push(t[i]);return e},y.pairs=function(t){var e=[];for(var i in t)y.has(t,i)&&e.push([i,t[i]]);return e},y.invert=function(t){var e={};for(var i in t)y.has(t,i)&&(e[t[i]]=i);return e},y.functions=y.methods=function(t){var e=[];for(var i in t)y.isFunction(t[i])&&e.push(i);return e.sort()},y.extend=function(t){return C(a.call(arguments,1),function(e){if(e)for(var i in e)t[i]=e[i]}),t},y.pick=function(t){var e={},i=l.apply(n,a.call(arguments,1));return C(i,function(i){i in t&&(e[i]=t[i])}),e},y.omit=function(t){var e={},i=l.apply(n,a.call(arguments,1));for(var r in t)y.contains(i,r)||(e[r]=t[r]);return e},y.defaults=function(t){return C(a.call(arguments,1),function(e){if(e)for(var i in e)null==t[i]&&(t[i]=e[i])}),t},y.clone=function(t){return y.isObject(t)?y.isArray(t)?t.slice():y.extend({},t):t},y.tap=function(t,e){return e(t),t};var E=function(t,e,i,n){if(t===e)return 0!==t||1/t==1/e;if(null==t||null==e)return t===e;t instanceof y&&(t=t._wrapped),e instanceof y&&(e=e._wrapped);var r=c.call(t);if(r!=c.call(e))return!1;switch(r){case"[object String]":return t==String(e);case"[object Number]":return t!=+t?e!=+e:0==t?1/t==1/e:t==+e;case"[object Date]":case"[object Boolean]":return+t==+e;case"[object RegExp]":return t.source==e.source&&t.global==e.global&&t.multiline==e.multiline&&t.ignoreCase==e.ignoreCase}if("object"!=typeof t||"object"!=typeof e)return!1;for(var s=i.length;s--;)if(i[s]==t)return n[s]==e;i.push(t),n.push(e);var o=0,a=!0;if("[object Array]"==r){if(o=t.length,a=o==e.length)for(;o--&&(a=E(t[o],e[o],i,n)););}else{var l=t.constructor,d=e.constructor;if(l!==d&&!(y.isFunction(l)&&l instanceof l&&y.isFunction(d)&&d instanceof d))return!1;for(var u in t)if(y.has(t,u)&&(o++,!(a=y.has(e,u)&&E(t[u],e[u],i,n))))break;if(a){for(u in e)if(y.has(e,u)&&!o--)break;a=!o}}return i.pop(),n.pop(),a};y.isEqual=function(t,e){return E(t,e,[],[])},y.isEmpty=function(t){if(null==t)return!0;if(y.isArray(t)||y.isString(t))return 0===t.length;for(var e in t)if(y.has(t,e))return!1;return!0},y.isElement=function(t){return!(!t||1!==t.nodeType)},y.isArray=x||function(t){return"[object Array]"==c.call(t)},y.isObject=function(t){return t===Object(t)},C(["Arguments","Function","String","Number","Date","RegExp"],function(t){y["is"+t]=function(e){return c.call(e)=="[object "+t+"]"}}),y.isArguments(arguments)||(y.isArguments=function(t){return!(!t||!y.has(t,"callee"))}),"function"!=typeof/./&&(y.isFunction=function(t){return"function"==typeof t}),y.isFinite=function(t){return isFinite(t)&&!isNaN(parseFloat(t))},y.isNaN=function(t){return y.isNumber(t)&&t!=+t},y.isBoolean=function(t){return t===!0||t===!1||"[object Boolean]"==c.call(t)},y.isNull=function(t){return null===t},y.isUndefined=function(t){return void 0===t},y.has=function(t,e){return d.call(t,e)},y.noConflict=function(){return t._=e,this},y.identity=function(t){return t},y.times=function(t,e,i){for(var n=Array(t),r=0;t>r;r++)n[r]=e.call(i,r);return n},y.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))};var $={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};$.unescape=y.invert($.escape);var D={escape:new RegExp("["+y.keys($.escape).join("")+"]","g"),unescape:new RegExp("("+y.keys($.unescape).join("|")+")","g")};y.each(["escape","unescape"],function(t){y[t]=function(e){return null==e?"":(""+e).replace(D[t],function(e){return $[t][e]})}}),y.result=function(t,e){if(null==t)return null;var i=t[e];return y.isFunction(i)?i.call(t):i},y.mixin=function(t){C(y.functions(t),function(e){var i=y[e]=t[e];y.prototype[e]=function(){var t=[this._wrapped];return o.apply(t,arguments),T.call(this,i.apply(y,t))}})};var q=0;y.uniqueId=function(t){var e=++q+"";return t?t+e:e},y.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var M=/(.)^/,N={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},j=/\\|'|\r|\n|\t|\u2028|\u2029/g;y.template=function(t,e,i){var n;i=y.defaults({},i,y.templateSettings);var r=new RegExp([(i.escape||M).source,(i.interpolate||M).source,(i.evaluate||M).source].join("|")+"|$","g"),s=0,o="__p+='";t.replace(r,function(e,i,n,r,a){return o+=t.slice(s,a).replace(j,function(t){return"\\"+N[t]}),i&&(o+="'+\n((__t=("+i+"))==null?'':_.escape(__t))+\n'"),n&&(o+="'+\n((__t=("+n+"))==null?'':__t)+\n'"),r&&(o+="';\n"+r+"\n__p+='"),s=a+e.length,e}),o+="';\n",i.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{n=new Function(i.variable||"obj","_",o)}catch(a){throw a.source=o,a}if(e)return n(e,y);var l=function(t){return n.call(this,t,y)};return l.source="function("+(i.variable||"obj")+"){\n"+o+"}",l},y.chain=function(t){return y(t).chain()};var T=function(t){return this._chain?y(t).chain():t};y.mixin(y),C(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var e=n[t];y.prototype[t]=function(){var i=this._wrapped;return e.apply(i,arguments),"shift"!=t&&"splice"!=t||0!==i.length||delete i[0],T.call(this,i)}}),C(["concat","join","slice"],function(t){var e=n[t];y.prototype[t]=function(){return T.call(this,e.apply(this._wrapped,arguments))}}),y.extend(y.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}.call(this),function(t){t.AV=t.AV||{};var e=t.AV;if("undefined"!=typeof exports&&exports._){e._=exports._.noConflict();try{e.localStorage=require("localStorage")}catch(i){e.localStorage=require("./localStorage.js").localStorage}e.XMLHttpRequest=require("xmlhttprequest").XMLHttpRequest,exports.AV=e}else e._=_.noConflict(),"undefined"!=typeof localStorage&&(e.localStorage=localStorage),"undefined"!=typeof XMLHttpRequest&&(e.XMLHttpRequest=XMLHttpRequest);"undefined"!=typeof $&&(e.$=$);var n=function(){},r=function(t,i,r){var s;return s=i&&i.hasOwnProperty("constructor")?i.constructor:function(){t.apply(this,arguments)},e._.extend(s,t),n.prototype=t.prototype,s.prototype=new n,i&&e._.extend(s.prototype,i),r&&e._.extend(s,r),s.prototype.constructor=s,s.__super__=t.prototype,s};e.serverURL="https://cn.avoscloud.com","undefined"!=typeof process&&process.versions&&process.versions.node&&(e._isNode=!0),e.initialize=function(t,i,n){if(n)throw"AV.initialize() was passed a Master Key, which is only allowed from within Node.js.";e._initialize(t,i,n)},e._initialize=function(t,i,n){e.applicationId=t,e.applicationKey=i,e.masterKey=n,e._useMasterKey=!1},e._isNode&&(e.initialize=e._initialize,e.Cloud=e.Cloud||{},e.Cloud.useMasterKey=function(){e._useMasterKey=!0}),e.useAVCloudCN=function(){e.serverURL="https://cn.avoscloud.com"},e.useAVCloudUS=function(){e.serverURL="https://us.avoscloud.com"},e._getAVPath=function(t){if(!e.applicationId)throw"You need to call AV.initialize before using AV.";if(t||(t=""),!e._.isString(t))throw"Tried to get a localStorage path that wasn't a String.";return"/"===t[0]&&(t=t.substring(1)),"AV/"+e.applicationId+"/"+t},e._installationId=null,e._getInstallationId=function(){if(e._installationId)return e._installationId;var t=e._getAVPath("installationId");if(e._installationId=e.localStorage.getItem(t),!e._installationId||""===e._installationId){var i=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};e._installationId=i()+i()+"-"+i()+"-"+i()+"-"+i()+"-"+i()+i()+i(),e.localStorage.setItem(t,e._installationId)}return e._installationId},e._parseDate=function(t){var e=new RegExp("^([0-9]{1,4})-([0-9]{1,2})-([0-9]{1,2})T([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2})(.([0-9]+))?Z$"),i=e.exec(t);if(!i)return null;var n=i[1]||0,r=(i[2]||1)-1,s=i[3]||0,o=i[4]||0,a=i[5]||0,l=i[6]||0,c=i[8]||0;return new Date(Date.UTC(n,r,s,o,a,l,c))},e._ajaxIE8=function(t,i,n){var r=new e.Promise,s=new XDomainRequest;return s.onload=function(){var t;try{t=JSON.parse(s.responseText)}catch(e){r.reject(e)}t&&r.resolve(t)},s.onerror=s.ontimeout=function(){r.reject(s)},s.onprogress=function(){},s.open(t,i),s.send(n),r},e._ajax=function(t,i,n,r,s){var o={success:r,error:s};if("undefined"!=typeof XDomainRequest)return e._ajaxIE8(t,i,n)._thenRunCallbacks(o);var a=new e.Promise,l=!1,c=new e.XMLHttpRequest;return c.onreadystatechange=function(){if(4===c.readyState){if(l)return;if(l=!0,c.status>=200&&c.status<300){var t;try{t=JSON.parse(c.responseText)}catch(e){a.reject(e)}t&&a.resolve(t,c.status,c)}else a.reject(c)}},c.open(t,i,!0),c.setRequestHeader("Content-Type","text/plain"),e._isNode&&c.setRequestHeader("User-Agent","AV/"+e.VERSION+" (NodeJS "+process.versions.node+")"),c.send(n),a._thenRunCallbacks(o)},e._extend=function(t,e){var i=r(this,t,e);return i.extend=this.extend,i},e._request=function(t,i,n,r,s){if(!e.applicationId)throw"You must specify your applicationId using AV.initialize";if(!e.applicationKey&&!e.masterKey)throw"You must specify a key using AV.initialize";if("batch"!==t&&"classes"!==t&&"files"!==t&&"functions"!==t&&"login"!==t&&"push"!==t&&"requestPasswordReset"!==t&&"users"!==t)throw"Bad route: '"+t+"'.";var o=e.serverURL;"/"!==o.charAt(o.length-1)&&(o+="/"),o+="1/"+t,i&&(o+="/"+i),n&&(o+="/"+n),s=e._.clone(s||{}),"POST"!==r&&(s._method=r,r="POST"),s._ApplicationId=e.applicationId,s._ApplicationKey=e.applicationKey,e._useMasterKey&&(s._MasterKey=e.masterKey),s._ClientVersion=e.VERSION,s._InstallationId=e._getInstallationId();var a=e.User.current();a&&a._sessionToken&&(s._SessionToken=a._sessionToken);var l=JSON.stringify(s);return e._ajax(r,o,l).then(null,function(t){var i;if(t&&t.responseText)try{var n=JSON.parse(t.responseText);n&&(i=new e.Error(n.code,n.error))}catch(r){}return i=i||new e.Error(-1,t.responseText),e.Promise.error(i)})},e._getValue=function(t,i){return t&&t[i]?e._.isFunction(t[i])?t[i]():t[i]:null},e._encode=function(t,i,n){var r=e._;if(t instanceof e.Object){if(n)throw"AV.Objects not allowed here";if(!i||r.include(i,t)||!t._hasData)return t._toPointer();if(!t.dirty())return i=i.concat(t),e._encode(t._toFullJSON(i),i,n);throw"Tried to save an object with a pointer to a new, unsaved object."}if(t instanceof e.ACL)return t.toJSON();if(r.isDate(t))return{__type:"Date",iso:t.toJSON()};if(t instanceof e.GeoPoint)return t.toJSON();if(r.isArray(t))return r.map(t,function(t){return e._encode(t,i,n)});if(r.isRegExp(t))return t.source;if(t instanceof e.Relation)return t.toJSON();if(t instanceof e.Op)return t.toJSON();if(t instanceof e.File){if(!t.url())throw"Tried to save an object containing an unsaved file.";return{__type:"File",id:t.id,name:t.name(),url:t.url()}}if(r.isObject(t)){var s={};return e._objectEach(t,function(t,r){s[r]=e._encode(t,i,n)}),s}return t},e._decode=function(t,i){var n=e._;if(!n.isObject(i))return i;if(n.isArray(i))return e._arrayEach(i,function(t,n){i[n]=e._decode(n,t)}),i;if(i instanceof e.Object)return i;if(i instanceof e.File)return i;if(i instanceof e.Op)return i;if(i.__op)return e.Op._decode(i);if("Pointer"===i.__type){var r=i.className,s=e.Object._create(r);return i.createdAt?(delete i.__type,delete i.className,s._finishFetch(i,!0)):s._finishFetch({objectId:i.objectId},!1),s}if("Object"===i.__type){var r=i.className;delete i.__type,delete i.className;var o=e.Object._create(r);return o._finishFetch(i,!0),o}if("Date"===i.__type)return e._parseDate(i.iso);if("GeoPoint"===i.__type)return new e.GeoPoint({latitude:i.latitude,longitude:i.longitude});if("ACL"===t)return i instanceof e.ACL?i:new e.ACL(i);if("Relation"===i.__type){var a=new e.Relation(null,t);return a.targetClassName=i.className,a}if("File"===i.__type){var l=new e.File(i.name);return l._metaData=i.metaData||{},l._url=i.url,l.id=i.objectId,l}return e._objectEach(i,function(t,n){i[n]=e._decode(n,t)}),i},e._arrayEach=e._.each,e._traverse=function(t,i,n){if(t instanceof e.Object){if(n=n||[],e._.indexOf(n,t)>=0)return;return n.push(t),e._traverse(t.attributes,i,n),i(t)}return t instanceof e.Relation||t instanceof e.File?i(t):e._.isArray(t)?(e._.each(t,function(r,s){var o=e._traverse(r,i,n);o&&(t[s]=o)}),i(t)):e._.isObject(t)?(e._each(t,function(r,s){var o=e._traverse(r,i,n);o&&(t[s]=o)}),i(t)):i(t)},e._objectEach=e._each=function(t,i){var n=e._;n.isObject(t)?n.each(n.keys(t),function(e){i(t[e],e)}):n.each(t,i)},e._isNullOrUndefined=function(t){return e._.isNull(t)||e._.isUndefined(t)}}(this),function(t){t.AV=t.AV||{};var e=t.AV,i=e._;e.Error=function(t,e){this.code=t,this.message=e},i.extend(e.Error,{OTHER_CAUSE:-1,INTERNAL_SERVER_ERROR:1,CONNECTION_FAILED:100,OBJECT_NOT_FOUND:101,INVALID_QUERY:102,INVALID_CLASS_NAME:103,MISSING_OBJECT_ID:104,INVALID_KEY_NAME:105,INVALID_POINTER:106,INVALID_JSON:107,COMMAND_UNAVAILABLE:108,NOT_INITIALIZED:109,INCORRECT_TYPE:111,INVALID_CHANNEL_NAME:112,PUSH_MISCONFIGURED:115,OBJECT_TOO_LARGE:116,OPERATION_FORBIDDEN:119,CACHE_MISS:120,INVALID_NESTED_KEY:121,INVALID_FILE_NAME:122,INVALID_ACL:123,TIMEOUT:124,INVALID_EMAIL_ADDRESS:125,MISSING_CONTENT_TYPE:126,MISSING_CONTENT_LENGTH:127,INVALID_CONTENT_LENGTH:128,FILE_TOO_LARGE:129,FILE_SAVE_ERROR:130,FILE_DELETE_ERROR:153,DUPLICATE_VALUE:137,INVALID_ROLE_NAME:139,EXCEEDED_QUOTA:140,SCRIPT_FAILED:141,VALIDATION_ERROR:142,INVALID_IMAGE_DATA:150,UNSAVED_FILE_ERROR:151,INVALID_PUSH_TIME_ERROR:152,USERNAME_MISSING:200,PASSWORD_MISSING:201,USERNAME_TAKEN:202,EMAIL_TAKEN:203,EMAIL_MISSING:204,EMAIL_NOT_FOUND:205,SESSION_MISSING:206,MUST_CREATE_USER_THROUGH_SIGNUP:207,ACCOUNT_ALREADY_LINKED:208,LINKED_ID_MISSING:250,INVALID_LINKED_SESSION:251,UNSUPPORTED_SERVICE:252})}(this),function(){var t=this,e=t.AV||(t.AV={}),i=/\s+/,n=Array.prototype.slice;e.Events={on:function(t,e,n){var r,s,o,a,l;if(!e)return this;for(t=t.split(i),r=this._callbacks||(this._callbacks={}),s=t.shift();s;)l=r[s],o=l?l.tail:{},o.next=a={},o.context=n,o.callback=e,r[s]={tail:a,next:l?l.next:o},s=t.shift();return this},off:function(t,e,n){var r,s,o,a,l,c;if(s=this._callbacks){if(!(t||e||n))return delete this._callbacks,this;for(t=t?t.split(i):_.keys(s),r=t.shift();r;)if(o=s[r],delete s[r],o&&(e||n)){for(a=o.tail,o=o.next;o!==a;)l=o.callback,c=o.context,(e&&l!==e||n&&c!==n)&&this.on(r,l,c),o=o.next;r=t.shift()}return this}},trigger:function(t){var e,r,s,o,a,l,c;if(!(s=this._callbacks))return this;for(l=s.all,t=t.split(i),c=n.call(arguments,1),e=t.shift();e;){if(r=s[e])for(o=r.tail;(r=r.next)!==o;)r.callback.apply(r.context||this,c);if(r=l)for(o=r.tail,a=[e].concat(c);(r=r.next)!==o;)r.callback.apply(r.context||this,a);e=t.shift()}return this}},e.Events.bind=e.Events.on,e.Events.unbind=e.Events.off}.call(this),function(t){t.AV=t.AV||{};var e=t.AV,i=e._;e.GeoPoint=function(t,n){i.isArray(t)?(e.GeoPoint._validate(t[0],t[1]),this.latitude=t[0],this.longitude=t[1]):i.isObject(t)?(e.GeoPoint._validate(t.latitude,t.longitude),this.latitude=t.latitude,this.longitude=t.longitude):i.isNumber(t)&&i.isNumber(n)?(e.GeoPoint._validate(t,n),this.latitude=t,this.longitude=n):(this.latitude=0,this.longitude=0);var r=this;this.__defineGetter__&&this.__defineSetter__&&(this._latitude=this.latitude,this._longitude=this.longitude,this.__defineGetter__("latitude",function(){return r._latitude}),this.__defineGetter__("longitude",function(){return r._longitude}),this.__defineSetter__("latitude",function(t){e.GeoPoint._validate(t,r.longitude),r._latitude=t}),this.__defineSetter__("longitude",function(t){e.GeoPoint._validate(r.latitude,t),r._longitude=t}))},e.GeoPoint._validate=function(t,e){if(-90>t)throw"AV.GeoPoint latitude "+t+" < -90.0.";if(t>90)throw"AV.GeoPoint latitude "+t+" > 90.0.";if(-180>e)throw"AV.GeoPoint longitude "+e+" < -180.0.";if(e>180)throw"AV.GeoPoint longitude "+e+" > 180.0."},e.GeoPoint.current=function(t){var i=new e.Promise;return navigator.geolocation.getCurrentPosition(function(t){i.resolve(new e.GeoPoint({latitude:t.coords.latitude,longitude:t.coords.longitude}))},function(t){i.reject(t)}),i._thenRunCallbacks(t)},e.GeoPoint.prototype={toJSON:function(){return e.GeoPoint._validate(this.latitude,this.longitude),{__type:"GeoPoint",latitude:this.latitude,longitude:this.longitude}},radiansTo:function(t){var e=Math.PI/180,i=this.latitude*e,n=this.longitude*e,r=t.latitude*e,s=t.longitude*e,o=i-r,a=n-s,l=Math.sin(o/2),c=Math.sin(a/2),d=l*l+Math.cos(i)*Math.cos(r)*c*c;return d=Math.min(1,d),2*Math.asin(Math.sqrt(d))},kilometersTo:function(t){return 6371*this.radiansTo(t)},milesTo:function(t){return 3958.8*this.radiansTo(t)}}}(this),function(t){t.AV=t.AV||{};var e=t.AV,i=e._,n="*";e.ACL=function(t){var n=this;if(n.permissionsById={},i.isObject(t))if(t instanceof e.User)n.setReadAccess(t,!0),n.setWriteAccess(t,!0);else{if(i.isFunction(t))throw"AV.ACL() called with a function.  Did you forget ()?";e._objectEach(t,function(t,r){if(!i.isString(r))throw"Tried to create an ACL with an invalid userId.";n.permissionsById[r]={},e._objectEach(t,function(t,e){if("read"!==e&&"write"!==e)throw"Tried to create an ACL with an invalid permission type.";if(!i.isBoolean(t))throw"Tried to create an ACL with an invalid permission value.";n.permissionsById[r][e]=t})})}},e.ACL.prototype.toJSON=function(){return i.clone(this.permissionsById)},e.ACL.prototype._setAccess=function(t,n,r){if(n instanceof e.User?n=n.id:n instanceof e.Role&&(n="role:"+n.getName()),!i.isString(n))throw"userId must be a string.";if(!i.isBoolean(r))throw"allowed must be either true or false.";var s=this.permissionsById[n];if(!s){if(!r)return;s={},this.permissionsById[n]=s}r?this.permissionsById[n][t]=!0:(delete s[t],i.isEmpty(s)&&delete s[n])},e.ACL.prototype._getAccess=function(t,i){i instanceof e.User?i=i.id:i instanceof e.Role&&(i="role:"+i.getName());var n=this.permissionsById[i];return n?n[t]?!0:!1:!1},e.ACL.prototype.setReadAccess=function(t,e){this._setAccess("read",t,e)},e.ACL.prototype.getReadAccess=function(t){return this._getAccess("read",t)},e.ACL.prototype.setWriteAccess=function(t,e){this._setAccess("write",t,e)},e.ACL.prototype.getWriteAccess=function(t){return this._getAccess("write",t)},e.ACL.prototype.setPublicReadAccess=function(t){this.setReadAccess(n,t)},e.ACL.prototype.getPublicReadAccess=function(){return this.getReadAccess(n)},e.ACL.prototype.setPublicWriteAccess=function(t){this.setWriteAccess(n,t)},e.ACL.prototype.getPublicWriteAccess=function(){return this.getWriteAccess(n)},e.ACL.prototype.getRoleReadAccess=function(t){if(t instanceof e.Role&&(t=t.getName()),i.isString(t))return this.getReadAccess("role:"+t);throw"role must be a AV.Role or a String"},e.ACL.prototype.getRoleWriteAccess=function(t){if(t instanceof e.Role&&(t=t.getName()),i.isString(t))return this.getWriteAccess("role:"+t);throw"role must be a AV.Role or a String"},e.ACL.prototype.setRoleReadAccess=function(t,n){if(t instanceof e.Role&&(t=t.getName()),i.isString(t))return this.setReadAccess("role:"+t,n),void 0;throw"role must be a AV.Role or a String"},e.ACL.prototype.setRoleWriteAccess=function(t,n){if(t instanceof e.Role&&(t=t.getName()),i.isString(t))return this.setWriteAccess("role:"+t,n),void 0;throw"role must be a AV.Role or a String"}}(this),function(t){t.AV=t.AV||{};var e=t.AV,i=e._;e.Op=function(){this._initialize.apply(this,arguments)},e.Op.prototype={_initialize:function(){}},i.extend(e.Op,{_extend:e._extend,_opDecoderMap:{},_registerDecoder:function(t,i){e.Op._opDecoderMap[t]=i},_decode:function(t){var i=e.Op._opDecoderMap[t.__op];return i?i(t):void 0}}),e.Op._registerDecoder("Batch",function(t){var i=null;return e._arrayEach(t.ops,function(t){t=e.Op._decode(t),i=t._mergeWithPrevious(i)}),i}),e.Op.Set=e.Op._extend({_initialize:function(t){this._value=t},value:function(){return this._value},toJSON:function(){return e._encode(this.value())},_mergeWithPrevious:function(){return this},_estimate:function(){return this.value()}}),e.Op._UNSET={},e.Op.Unset=e.Op._extend({toJSON:function(){return{__op:"Delete"}},_mergeWithPrevious:function(){return this},_estimate:function(){return e.Op._UNSET}}),e.Op._registerDecoder("Delete",function(){return new e.Op.Unset}),e.Op.Increment=e.Op._extend({_initialize:function(t){this._amount=t},amount:function(){return this._amount},toJSON:function(){return{__op:"Increment",amount:this._amount}},_mergeWithPrevious:function(t){if(t){if(t instanceof e.Op.Unset)return new e.Op.Set(this.amount());if(t instanceof e.Op.Set)return new e.Op.Set(t.value()+this.amount());if(t instanceof e.Op.Increment)return new e.Op.Increment(this.amount()+t.amount());throw"Op is invalid after previous op."}return this},_estimate:function(t){return t?t+this.amount():this.amount()}}),e.Op._registerDecoder("Increment",function(t){return new e.Op.Increment(t.amount)}),e.Op.Add=e.Op._extend({_initialize:function(t){this._objects=t},objects:function(){return this._objects},toJSON:function(){return{__op:"Add",objects:e._encode(this.objects())}},_mergeWithPrevious:function(t){if(t){if(t instanceof e.Op.Unset)return new e.Op.Set(this.objects());if(t instanceof e.Op.Set)return new e.Op.Set(this._estimate(t.value()));if(t instanceof e.Op.Add)return new e.Op.Add(t.objects().concat(this.objects()));throw"Op is invalid after previous op."}return this},_estimate:function(t){return t?t.concat(this.objects()):i.clone(this.objects())}}),e.Op._registerDecoder("Add",function(t){return new e.Op.Add(e._decode(void 0,t.objects))}),e.Op.AddUnique=e.Op._extend({_initialize:function(t){this._objects=i.uniq(t)},objects:function(){return this._objects},toJSON:function(){return{__op:"AddUnique",objects:e._encode(this.objects())}},_mergeWithPrevious:function(t){if(t){if(t instanceof e.Op.Unset)return new e.Op.Set(this.objects());if(t instanceof e.Op.Set)return new e.Op.Set(this._estimate(t.value()));if(t instanceof e.Op.AddUnique)return new e.Op.AddUnique(this._estimate(t.objects()));throw"Op is invalid after previous op."}return this},_estimate:function(t){if(t){var n=i.clone(t);return e._arrayEach(this.objects(),function(t){if(t instanceof e.Object&&t.id){var r=i.find(n,function(i){return i instanceof e.Object&&i.id===t.id});if(r){var s=i.indexOf(n,r);n[s]=t}else n.push(t)}else i.contains(n,t)||n.push(t)}),n}return i.clone(this.objects())}}),e.Op._registerDecoder("AddUnique",function(t){return new e.Op.AddUnique(e._decode(void 0,t.objects))}),e.Op.Remove=e.Op._extend({_initialize:function(t){this._objects=i.uniq(t)},objects:function(){return this._objects},toJSON:function(){return{__op:"Remove",objects:e._encode(this.objects())}},_mergeWithPrevious:function(t){if(t){if(t instanceof e.Op.Unset)return t;if(t instanceof e.Op.Set)return new e.Op.Set(this._estimate(t.value()));if(t instanceof e.Op.Remove)return new e.Op.Remove(i.union(t.objects(),this.objects()));throw"Op is invalid after previous op."}return this},_estimate:function(t){if(t){var n=i.difference(t,this.objects());return e._arrayEach(this.objects(),function(t){t instanceof e.Object&&t.id&&(n=i.reject(n,function(i){return i instanceof e.Object&&i.id===t.id}))}),n}return[]}}),e.Op._registerDecoder("Remove",function(t){return new e.Op.Remove(e._decode(void 0,t.objects))}),e.Op.Relation=e.Op._extend({_initialize:function(t,n){this._targetClassName=null;var r=this,s=function(t){if(t instanceof e.Object){if(!t.id)throw"You can't add an unsaved AV.Object to a relation.";if(r._targetClassName||(r._targetClassName=t.className),r._targetClassName!==t.className)throw"Tried to create a AV.Relation with 2 different types: "+r._targetClassName+" and "+t.className+".";return t.id}return t};this.relationsToAdd=i.uniq(i.map(t,s)),this.relationsToRemove=i.uniq(i.map(n,s))},added:function(){var t=this;return i.map(this.relationsToAdd,function(i){var n=e.Object._create(t._targetClassName);return n.id=i,n})},removed:function(){var t=this;return i.map(this.relationsToRemove,function(i){var n=e.Object._create(t._targetClassName);return n.id=i,n})},toJSON:function(){var t=null,e=null,n=this,r=function(t){return{__type:"Pointer",className:n._targetClassName,objectId:t}},s=null;return this.relationsToAdd.length>0&&(s=i.map(this.relationsToAdd,r),t={__op:"AddRelation",objects:s}),this.relationsToRemove.length>0&&(s=i.map(this.relationsToRemove,r),e={__op:"RemoveRelation",objects:s}),t&&e?{__op:"Batch",ops:[t,e]}:t||e||{}
},_mergeWithPrevious:function(t){if(t){if(t instanceof e.Op.Unset)throw"You can't modify a relation after deleting it.";if(t instanceof e.Op.Relation){if(t._targetClassName&&t._targetClassName!==this._targetClassName)throw"Related object must be of class "+t._targetClassName+", but "+this._targetClassName+" was passed in.";var n=i.union(i.difference(t.relationsToAdd,this.relationsToRemove),this.relationsToAdd),r=i.union(i.difference(t.relationsToRemove,this.relationsToAdd),this.relationsToRemove),s=new e.Op.Relation(n,r);return s._targetClassName=this._targetClassName,s}throw"Op is invalid after previous op."}return this},_estimate:function(t,i,n){if(t){if(t instanceof e.Relation){if(this._targetClassName)if(t.targetClassName){if(t.targetClassName!==this._targetClassName)throw"Related object must be a "+t.targetClassName+", but a "+this._targetClassName+" was passed in."}else t.targetClassName=this._targetClassName;return t}throw"Op is invalid after previous op."}var r=new e.Relation(i,n);r.targetClassName=this._targetClassName}}),e.Op._registerDecoder("AddRelation",function(t){return new e.Op.Relation(e._decode(void 0,t.objects),[])}),e.Op._registerDecoder("RemoveRelation",function(t){return new e.Op.Relation([],e._decode(void 0,t.objects))})}(this),function(t){t.AV=t.AV||{};var e=t.AV,i=e._;e.Relation=function(t,e){this.parent=t,this.key=e,this.targetClassName=null},e.Relation.prototype={_ensureParentAndKey:function(t,e){if(this.parent=this.parent||t,this.key=this.key||e,this.parent!==t)throw"Internal Error. Relation retrieved from two different Objects.";if(this.key!==e)throw"Internal Error. Relation retrieved from two different keys."},add:function(t){i.isArray(t)||(t=[t]);var n=new e.Op.Relation(t,[]);this.parent.set(this.key,n),this.targetClassName=n._targetClassName},remove:function(t){i.isArray(t)||(t=[t]);var n=new e.Op.Relation([],t);this.parent.set(this.key,n),this.targetClassName=n._targetClassName},toJSON:function(){return{__type:"Relation",className:this.targetClassName}},query:function(){var t,i;return this.targetClassName?(t=e.Object._getSubclass(this.targetClassName),i=new e.Query(t)):(t=e.Object._getSubclass(this.parent.className),i=new e.Query(t),i._extraOptions.redirectClassNameForKey=this.key),i._addCondition("$relatedTo","object",this.parent._toPointer()),i._addCondition("$relatedTo","key",this.key),i}}}(this),function(t){t.AV=t.AV||{};var e=t.AV,i=e._;e.Promise=function(){this._resolved=!1,this._rejected=!1,this._resolvedCallbacks=[],this._rejectedCallbacks=[]},i.extend(e.Promise,{is:function(t){return t&&t.then&&i.isFunction(t.then)},as:function(){var t=new e.Promise;return t.resolve.apply(t,arguments),t},error:function(){var t=new e.Promise;return t.reject.apply(t,arguments),t},when:function(t){var i;i=t&&e._isNullOrUndefined(t.length)?arguments:t;var n=i.length,r=!1,s=[],o=[];if(s.length=i.length,o.length=i.length,0===n)return e.Promise.as.apply(this,s);var a=new e.Promise,l=function(){n-=1,0===n&&(r?a.reject(o):a.resolve.apply(a,s))};return e._arrayEach(i,function(t,i){e.Promise.is(t)?t.then(function(t){s[i]=t,l()},function(t){o[i]=t,r=!0,l()}):(s[i]=t,l())}),a},_continueWhile:function(t,i){return t()?i().then(function(){return e.Promise._continueWhile(t,i)}):e.Promise.as()}}),i.extend(e.Promise.prototype,{resolve:function(){if(this._resolved||this._rejected)throw"A promise was resolved even though it had already been "+(this._resolved?"resolved":"rejected")+".";this._resolved=!0,this._result=arguments;var t=arguments;e._arrayEach(this._resolvedCallbacks,function(e){e.apply(this,t)}),this._resolvedCallbacks=[],this._rejectedCallbacks=[]},reject:function(t){if(this._resolved||this._rejected)throw"A promise was rejected even though it had already been "+(this._resolved?"resolved":"rejected")+".";this._rejected=!0,this._error=t,e._arrayEach(this._rejectedCallbacks,function(e){e(t)}),this._resolvedCallbacks=[],this._rejectedCallbacks=[]},then:function(t,i){var n=new e.Promise,r=function(){var i=arguments;t&&(i=[t.apply(this,i)]),1===i.length&&e.Promise.is(i[0])?i[0].then(function(){n.resolve.apply(n,arguments)},function(t){n.reject(t)}):n.resolve.apply(n,i)},s=function(t){var r=[];i?(r=[i(t)],1===r.length&&e.Promise.is(r[0])?r[0].then(function(){n.resolve.apply(n,arguments)},function(t){n.reject(t)}):n.reject(r[0])):n.reject(t)};return this._resolved?r.apply(this,this._result):this._rejected?s(this._error):(this._resolvedCallbacks.push(r),this._rejectedCallbacks.push(s)),n},_thenRunCallbacks:function(t,n){var r;if(i.isFunction(t)){var s=t;r={success:function(t){s(t,null)},error:function(t){s(null,t)}}}else r=i.clone(t);return r=r||{},this.then(function(t){return r.success?r.success.apply(this,arguments):n&&n.trigger("sync",n,t,r),e.Promise.as.apply(e.Promise,arguments)},function(t){return r.error?i.isUndefined(n)?r.error(t):r.error(n,t):n&&n.trigger("error",n,t,r),e.Promise.error(t)})},_continueWith:function(t){return this.then(function(){return t(arguments,null)},function(e){return t(null,e)})}})}(this),function(t){t.AV=t.AV||{};var e=t.AV,i=e._,n=function(t){if(26>t)return String.fromCharCode(65+t);if(52>t)return String.fromCharCode(97+(t-26));if(62>t)return String.fromCharCode(48+(t-52));if(62===t)return"+";if(63===t)return"/";throw"Tried to encode large digit "+t+" in base64."},r=function(t){var e=[];return e.length=Math.ceil(t.length/3),i.times(e.length,function(i){var r=t[3*i],s=t[3*i+1]||0,o=t[3*i+2]||0,a=3*i+1<t.length,l=3*i+2<t.length;e[i]=[n(63&r>>2),n(48&r<<4|15&s>>4),a?n(60&s<<2|3&o>>6):"=",l?n(63&o):"="].join("")}),e.join("")},s={ai:"application/postscript",aif:"audio/x-aiff",aifc:"audio/x-aiff",aiff:"audio/x-aiff",asc:"text/plain",atom:"application/atom+xml",au:"audio/basic",avi:"video/x-msvideo",bcpio:"application/x-bcpio",bin:"application/octet-stream",bmp:"image/bmp",cdf:"application/x-netcdf",cgm:"image/cgm","class":"application/octet-stream",cpio:"application/x-cpio",cpt:"application/mac-compactpro",csh:"application/x-csh",css:"text/css",dcr:"application/x-director",dif:"video/x-dv",dir:"application/x-director",djv:"image/vnd.djvu",djvu:"image/vnd.djvu",dll:"application/octet-stream",dmg:"application/octet-stream",dms:"application/octet-stream",doc:"application/msword",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",dotx:"application/vnd.openxmlformats-officedocument.wordprocessingml.template",docm:"application/vnd.ms-word.document.macroEnabled.12",dotm:"application/vnd.ms-word.template.macroEnabled.12",dtd:"application/xml-dtd",dv:"video/x-dv",dvi:"application/x-dvi",dxr:"application/x-director",eps:"application/postscript",etx:"text/x-setext",exe:"application/octet-stream",ez:"application/andrew-inset",gif:"image/gif",gram:"application/srgs",grxml:"application/srgs+xml",gtar:"application/x-gtar",hdf:"application/x-hdf",hqx:"application/mac-binhex40",htm:"text/html",html:"text/html",ice:"x-conference/x-cooltalk",ico:"image/x-icon",ics:"text/calendar",ief:"image/ief",ifb:"text/calendar",iges:"model/iges",igs:"model/iges",jnlp:"application/x-java-jnlp-file",jp2:"image/jp2",jpe:"image/jpeg",jpeg:"image/jpeg",jpg:"image/jpeg",js:"application/x-javascript",kar:"audio/midi",latex:"application/x-latex",lha:"application/octet-stream",lzh:"application/octet-stream",m3u:"audio/x-mpegurl",m4a:"audio/mp4a-latm",m4b:"audio/mp4a-latm",m4p:"audio/mp4a-latm",m4u:"video/vnd.mpegurl",m4v:"video/x-m4v",mac:"image/x-macpaint",man:"application/x-troff-man",mathml:"application/mathml+xml",me:"application/x-troff-me",mesh:"model/mesh",mid:"audio/midi",midi:"audio/midi",mif:"application/vnd.mif",mov:"video/quicktime",movie:"video/x-sgi-movie",mp2:"audio/mpeg",mp3:"audio/mpeg",mp4:"video/mp4",mpe:"video/mpeg",mpeg:"video/mpeg",mpg:"video/mpeg",mpga:"audio/mpeg",ms:"application/x-troff-ms",msh:"model/mesh",mxu:"video/vnd.mpegurl",nc:"application/x-netcdf",oda:"application/oda",ogg:"application/ogg",pbm:"image/x-portable-bitmap",pct:"image/pict",pdb:"chemical/x-pdb",pdf:"application/pdf",pgm:"image/x-portable-graymap",pgn:"application/x-chess-pgn",pic:"image/pict",pict:"image/pict",png:"image/png",pnm:"image/x-portable-anymap",pnt:"image/x-macpaint",pntg:"image/x-macpaint",ppm:"image/x-portable-pixmap",ppt:"application/vnd.ms-powerpoint",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",potx:"application/vnd.openxmlformats-officedocument.presentationml.template",ppsx:"application/vnd.openxmlformats-officedocument.presentationml.slideshow",ppam:"application/vnd.ms-powerpoint.addin.macroEnabled.12",pptm:"application/vnd.ms-powerpoint.presentation.macroEnabled.12",potm:"application/vnd.ms-powerpoint.template.macroEnabled.12",ppsm:"application/vnd.ms-powerpoint.slideshow.macroEnabled.12",ps:"application/postscript",qt:"video/quicktime",qti:"image/x-quicktime",qtif:"image/x-quicktime",ra:"audio/x-pn-realaudio",ram:"audio/x-pn-realaudio",ras:"image/x-cmu-raster",rdf:"application/rdf+xml",rgb:"image/x-rgb",rm:"application/vnd.rn-realmedia",roff:"application/x-troff",rtf:"text/rtf",rtx:"text/richtext",sgm:"text/sgml",sgml:"text/sgml",sh:"application/x-sh",shar:"application/x-shar",silo:"model/mesh",sit:"application/x-stuffit",skd:"application/x-koan",skm:"application/x-koan",skp:"application/x-koan",skt:"application/x-koan",smi:"application/smil",smil:"application/smil",snd:"audio/basic",so:"application/octet-stream",spl:"application/x-futuresplash",src:"application/x-wais-source",sv4cpio:"application/x-sv4cpio",sv4crc:"application/x-sv4crc",svg:"image/svg+xml",swf:"application/x-shockwave-flash",t:"application/x-troff",tar:"application/x-tar",tcl:"application/x-tcl",tex:"application/x-tex",texi:"application/x-texinfo",texinfo:"application/x-texinfo",tif:"image/tiff",tiff:"image/tiff",tr:"application/x-troff",tsv:"text/tab-separated-values",txt:"text/plain",ustar:"application/x-ustar",vcd:"application/x-cdlink",vrml:"model/vrml",vxml:"application/voicexml+xml",wav:"audio/x-wav",wbmp:"image/vnd.wap.wbmp",wbmxl:"application/vnd.wap.wbxml",wml:"text/vnd.wap.wml",wmlc:"application/vnd.wap.wmlc",wmls:"text/vnd.wap.wmlscript",wmlsc:"application/vnd.wap.wmlscriptc",wrl:"model/vrml",xbm:"image/x-xbitmap",xht:"application/xhtml+xml",xhtml:"application/xhtml+xml",xls:"application/vnd.ms-excel",xml:"application/xml",xpm:"image/x-xpixmap",xsl:"application/xml",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",xltx:"application/vnd.openxmlformats-officedocument.spreadsheetml.template",xlsm:"application/vnd.ms-excel.sheet.macroEnabled.12",xltm:"application/vnd.ms-excel.template.macroEnabled.12",xlam:"application/vnd.ms-excel.addin.macroEnabled.12",xlsb:"application/vnd.ms-excel.sheet.binary.macroEnabled.12",xslt:"application/xslt+xml",xul:"application/vnd.mozilla.xul+xml",xwd:"image/x-xwindowdump",xyz:"chemical/x-xyz",zip:"application/zip"},o=function(t,i){var n=new e.Promise;if("undefined"==typeof FileReader)return e.Promise.error(new e.Error(-1,"Attempted to use a FileReader on an unsupported browser."));var r=new FileReader;return r.onloadend=function(){if(2!==r.readyState)return n.reject(new e.Error(-1,"Error reading file.")),void 0;var t=r.result,s=/^data:([^;]*);base64,(.*)$/.exec(t);return s?(n.resolve(s[2],i||s[1]),void 0):(n.reject(new e.Error(-1,"Unable to interpret data URL: "+t)),void 0)},r.readAsDataURL(t),n};e.File=function(t,n,a){this._name=t;var l=e.User.current();this._metaData={owner:null!=l?l.id:"unknown"};var c=/\.([^.]*)$/.exec(t);c&&(c=c[1].toLowerCase());var d=a||s[c]||"text/plain";if(i.isArray(n))this._source=e.Promise.as(r(n),d),this._metaData.size=n.length;else if(n&&n.base64)this._source=e.Promise.as(n.base64,d),this._metaData.size=n.base64.length;else if("undefined"!=typeof File&&n instanceof File)this._source=o(n,a);else if(i.isString(n))throw"Creating a AV.File from a String is not yet supported."},e.File.prototype={name:function(){return this._name},url:function(){return this._url},metaData:function(){return this._metaData},size:function(){return this.metaData().size},ownerId:function(){return this.metaData().owner},destroy:function(t){if(this.id){var i=e._request("files",null,this.id,"DELETE");return i._thenRunCallbacks(t)}},save:function(t){var i=this;return i._previousSave||(i._previousSave=i._source.then(function(t,n){var r={base64:t,_ContentType:n,metaData:i._metaData};return i._metaData.size||(i._metaData.size=t.length),e._request("files",i._name,null,"POST",r)}).then(function(t){return i._name=t.name,i._url=t.url,i.id=t.objectId,i._metaData.size=t.size,i})),i._previousSave._thenRunCallbacks(t)}}}(this),function(t){t.AV=t.AV||{};var e=t.AV,i=e._;e.Object=function(t,n){if(i.isString(t))return e.Object._create.apply(this,arguments);t=t||{},n&&n.parse&&(t=this.parse(t));var r=e._getValue(this,"defaults");if(r&&(t=i.extend({},r,t)),n&&n.collection&&(this.collection=n.collection),this._serverData={},this._opSetQueue=[{}],this.attributes={},this._hashedJSON={},this._escapedAttributes={},this.cid=i.uniqueId("c"),this.changed={},this._silent={},this._pending={},!this.set(t,{silent:!0}))throw new Error("Can't create an invalid AV.Object");this.changed={},this._silent={},this._pending={},this._hasData=!0,this._previousAttributes=i.clone(this.attributes),this.initialize.apply(this,arguments)},e.Object.saveAll=function(t,i){return e.Object._deepSaveAsync(t)._thenRunCallbacks(i)},i.extend(e.Object.prototype,e.Events,{_existed:!1,initialize:function(){},toJSON:function(){var t=this._toFullJSON();return e._arrayEach(["__type","className"],function(e){delete t[e]}),t},_toFullJSON:function(t){var n=i.clone(this.attributes);return e._objectEach(n,function(i,r){n[r]=e._encode(i,t)}),e._objectEach(this._operations,function(t,e){n[e]=t}),i.has(this,"id")&&(n.objectId=this.id),i.has(this,"createdAt")&&(n.createdAt=i.isDate(this.createdAt)?this.createdAt.toJSON():this.createdAt),i.has(this,"updatedAt")&&(n.updatedAt=i.isDate(this.updatedAt)?this.updatedAt.toJSON():this.updatedAt),n.__type="Object",n.className=this.className,n},_refreshCache:function(){var t=this;t._refreshingCache||(t._refreshingCache=!0,e._objectEach(this.attributes,function(n,r){n instanceof e.Object?n._refreshCache():i.isObject(n)&&t._resetCacheForKey(r)&&t.set(r,new e.Op.Set(n),{silent:!0})}),delete t._refreshingCache)},dirty:function(t){this._refreshCache();var e=i.last(this._opSetQueue);return t?e[t]?!0:!1:this.id?i.keys(e).length>0?!0:!1:!0},_toPointer:function(){return{__type:"Pointer",className:this.className,objectId:this.id}},get:function(t){return this.attributes[t]},relation:function(t){var i=this.get(t);if(i){if(!(i instanceof e.Relation))throw"Called relation() on non-relation field "+t;return i._ensureParentAndKey(this,t),i}return new e.Relation(this,t)},escape:function(t){var n=this._escapedAttributes[t];if(n)return n;var r,s=this.attributes[t];return r=e._isNullOrUndefined(s)?"":i.escape(s.toString()),this._escapedAttributes[t]=r,r},has:function(t){return!e._isNullOrUndefined(this.attributes[t])},_mergeMagicFields:function(t){var n=this,r=["id","objectId","createdAt","updatedAt"];e._arrayEach(r,function(r){t[r]&&("objectId"===r?n.id=t[r]:n[r]="createdAt"!==r&&"updatedAt"!==r||i.isDate(t[r])?t[r]:e._parseDate(t[r]),delete t[r])})},_startSave:function(){this._opSetQueue.push({})},_cancelSave:function(){var t=i.first(this._opSetQueue);this._opSetQueue=i.rest(this._opSetQueue);var n=i.first(this._opSetQueue);e._objectEach(t,function(e,i){var r=t[i],s=n[i];r&&s?n[i]=s._mergeWithPrevious(r):r&&(n[i]=r)}),this._saving=this._saving-1},_finishSave:function(t){var n={};e._traverse(this.attributes,function(t){t instanceof e.Object&&t.id&&t._hasData&&(n[t.id]=t)});var r=i.first(this._opSetQueue);this._opSetQueue=i.rest(this._opSetQueue),this._applyOpSet(r,this._serverData),this._mergeMagicFields(t);var s=this;e._objectEach(t,function(t,i){s._serverData[i]=e._decode(i,t);var r=e._traverse(s._serverData[i],function(t){return t instanceof e.Object&&n[t.id]?n[t.id]:void 0});r&&(s._serverData[i]=r)}),this._rebuildAllEstimatedData(),this._saving=this._saving-1},_finishFetch:function(t,i){this._opSetQueue=[{}],this._mergeMagicFields(t);var n=this;e._objectEach(t,function(t,i){n._serverData[i]=e._decode(i,t)}),this._rebuildAllEstimatedData(),this._refreshCache(),this._opSetQueue=[{}],this._hasData=i},_applyOpSet:function(t,i){var n=this;e._objectEach(t,function(t,r){i[r]=t._estimate(i[r],n,r),i[r]===e.Op._UNSET&&delete i[r]})},_resetCacheForKey:function(t){var n=this.attributes[t];if(!(!i.isObject(n)||n instanceof e.Object||n instanceof e.File)){n=n.toJSON?n.toJSON():n;var r=JSON.stringify(n);if(this._hashedJSON[t]!==r)return this._hashedJSON[t]=r,!0}return!1},_rebuildEstimatedDataForKey:function(t){var i=this;delete this.attributes[t],this._serverData[t]&&(this.attributes[t]=this._serverData[t]),e._arrayEach(this._opSetQueue,function(n){var r=n[t];r&&(i.attributes[t]=r._estimate(i.attributes[t],i,t),i.attributes[t]===e.Op._UNSET?delete i.attributes[t]:i._resetCacheForKey(t))})},_rebuildAllEstimatedData:function(){var t=this,n=i.clone(this.attributes);this.attributes=i.clone(this._serverData),e._arrayEach(this._opSetQueue,function(i){t._applyOpSet(i,t.attributes),e._objectEach(i,function(e,i){t._resetCacheForKey(i)})}),e._objectEach(n,function(e,i){t.attributes[i]!==e&&t.trigger("change:"+i,t,t.attributes[i],{})}),e._objectEach(this.attributes,function(e,r){i.has(n,r)||t.trigger("change:"+r,t,e,{})})},set:function(t,n,r){var s;if(i.isObject(t)||e._isNullOrUndefined(t)?(s=t,e._objectEach(s,function(t,i){s[i]=e._decode(i,t)}),r=n):(s={},s[t]=e._decode(t,n)),r=r||{},!s)return this;s instanceof e.Object&&(s=s.attributes),r.unset&&e._objectEach(s,function(t,i){s[i]=new e.Op.Unset});var o=i.clone(s),a=this;if(e._objectEach(o,function(t,i){t instanceof e.Op&&(o[i]=t._estimate(a.attributes[i],a,i),o[i]===e.Op._UNSET&&delete o[i])}),!this._validate(s,r))return!1;this._mergeMagicFields(s),r.changes={};var l=this._escapedAttributes;return this._previousAttributes||{},e._arrayEach(i.keys(s),function(t){var n=s[t];n instanceof e.Relation&&(n.parent=a),n instanceof e.Op||(n=new e.Op.Set(n));var o=!0;n instanceof e.Op.Set&&i.isEqual(a.attributes[t],n.value)&&(o=!1),o&&(delete l[t],r.silent?a._silent[t]=!0:r.changes[t]=!0);var c=i.last(a._opSetQueue);c[t]=n._mergeWithPrevious(c[t]),a._rebuildEstimatedDataForKey(t),o?(a.changed[t]=a.attributes[t],r.silent||(a._pending[t]=!0)):(delete a.changed[t],delete a._pending[t])}),r.silent||this.change(r),this},unset:function(t,e){return e=e||{},e.unset=!0,this.set(t,null,e)},increment:function(t,n){return(i.isUndefined(n)||i.isNull(n))&&(n=1),this.set(t,new e.Op.Increment(n))},add:function(t,i){return this.set(t,new e.Op.Add([i]))},addUnique:function(t,i){return this.set(t,new e.Op.AddUnique([i]))},remove:function(t,i){return this.set(t,new e.Op.Remove([i]))},op:function(t){return i.last(this._opSetQueue)[t]},clear:function(t){t=t||{},t.unset=!0;var e=i.extend(this.attributes,this._operations);return this.set(e,t)},_getSaveJSON:function(){var t=i.clone(i.first(this._opSetQueue));return e._objectEach(t,function(e,i){t[i]=e.toJSON()}),t},_canBeSerialized:function(){return e.Object._canBeSerializedAsValue(this.attributes)},fetch:function(t){var i=this,n=e._request("classes",this.className,this.id,"GET");return n.then(function(t,e,n){return i._finishFetch(i.parse(t,e,n),!0),i})._thenRunCallbacks(t,this)},save:function(t,n,r){var s,o,a;if(i.isObject(t)||e._isNullOrUndefined(t)?(s=t,a=n):(s={},s[t]=n,a=r),!a&&s){var l=i.reject(s,function(t,e){return i.include(["success","error","wait"],e)});if(0===l.length){var c=!0;if(i.has(s,"success")&&!i.isFunction(s.success)&&(c=!1),i.has(s,"error")&&!i.isFunction(s.error)&&(c=!1),c)return this.save(null,s)}}a=i.clone(a)||{},a.wait&&(o=i.clone(this.attributes));var d=i.clone(a)||{};d.wait&&(d.silent=!0);var u;if(d.error=function(t,e){u=e},s&&!this.set(s,d))return e.Promise.error(u)._thenRunCallbacks(a,this);var h=this;h._refreshCache();var f=[],p=[];return e.Object._findUnsavedChildren(h.attributes,f,p),f.length+p.length>0?e.Object._deepSaveAsync(this.attributes).then(function(){return h.save(null,a)},function(t){return e.Promise.error(t)._thenRunCallbacks(a,h)}):(this._startSave(),this._saving=(this._saving||0)+1,this._allPreviousSaves=this._allPreviousSaves||e.Promise.as(),this._allPreviousSaves=this._allPreviousSaves._continueWith(function(){var t=h.id?"PUT":"POST",n=h._getSaveJSON(),r="classes",l=h.className;"_User"!==h.className||h.id||(r="users",l=null);var c=e._request(r,l,h.id,t,n);return c=c.then(function(t,e,n){var r=h.parse(t,e,n);return a.wait&&(r=i.extend(s||{},r)),h._finishSave(r),a.wait&&h.set(o,d),h},function(t){return h._cancelSave(),e.Promise.error(t)})._thenRunCallbacks(a,h)}),this._allPreviousSaves)},destroy:function(t){t=t||{};var i=this,n=function(){i.trigger("destroy",i,i.collection,t)};if(!this.id)return n();t.wait||n();var r=e._request("classes",this.className,this.id,"DELETE");return r.then(function(){return t.wait&&n(),i})._thenRunCallbacks(t,this)},parse:function(t,n){var r=i.clone(t);return i(["createdAt","updatedAt"]).each(function(t){r[t]&&(r[t]=e._parseDate(r[t]))}),r.updatedAt||(r.updatedAt=r.createdAt),n&&(this._existed=201!==n),r},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.id},change:function(t){t=t||{};var n=this._changing;this._changing=!0;var r=this;e._objectEach(this._silent,function(t){r._pending[t]=!0});var s=i.extend({},t.changes,this._silent);if(this._silent={},e._objectEach(s,function(e,i){r.trigger("change:"+i,r,r.get(i),t)}),n)return this;for(var o=function(t,e){r._pending[e]||r._silent[e]||delete r.changed[e]};!i.isEmpty(this._pending);)this._pending={},this.trigger("change",this,t),e._objectEach(this.changed,o),r._previousAttributes=i.clone(this.attributes);return this._changing=!1,this},existed:function(){return this._existed},hasChanged:function(t){return arguments.length?this.changed&&i.has(this.changed,t):!i.isEmpty(this.changed)},changedAttributes:function(t){if(!t)return this.hasChanged()?i.clone(this.changed):!1;var n={},r=this._previousAttributes;return e._objectEach(t,function(t,e){i.isEqual(r[e],t)||(n[e]=t)}),n},previous:function(t){return arguments.length&&this._previousAttributes?this._previousAttributes[t]:null},previousAttributes:function(){return i.clone(this._previousAttributes)},isValid:function(){return!this.validate(this.attributes)},validate:function(t){return!i.has(t,"ACL")||t.ACL instanceof e.ACL?!1:new e.Error(e.Error.OTHER_CAUSE,"ACL must be a AV.ACL.")},_validate:function(t,e){if(e.silent||!this.validate)return!0;t=i.extend({},this.attributes,t);var n=this.validate(t,e);return n?(e&&e.error?e.error(this,n,e):this.trigger("error",this,n,e),!1):!0},getACL:function(){return this.get("ACL")},setACL:function(t,e){return this.set("ACL",t,e)}}),e.Object.createWithoutData=function(t,i,n){var r=new e.Object(t);return r.id=i,r._hasData=n,r},e.Object.destroyAll=function(t,i){if(null==t||0==t.length)return e.Promise.as()._thenRunCallbacks(i);var n=t[0].className,r="",s=!0;t.forEach(function(t){if(t.className!=n)throw"AV.Object.destroyAll requires the argument object array's classNames must be the same";if(!t.id)throw"Could not delete unsaved object";s?(r=t.id,s=!1):r=r+","+t.id});var o=e._request("classes",n,r,"DELETE");return o._thenRunCallbacks(i)},e.Object._getSubclass=function(t){if(!i.isString(t))throw"AV.Object._getSubclass requires a string argument.";var n=e.Object._classMap[t];return n||(n=e.Object.extend(t),e.Object._classMap[t]=n),n},e.Object._create=function(t,i,n){var r=e.Object._getSubclass(t);return new r(i,n)},e.Object._classMap={},e.Object._extend=e._extend,e.Object.extend=function(t,n,r){if(!i.isString(t)){if(t&&i.has(t,"className"))return e.Object.extend(t.className,t,n);throw new Error("AV.Object.extend's first argument should be the className.")}"User"===t&&(t="_User");var s=null;if(i.has(e.Object._classMap,t)){var o=e.Object._classMap[t];s=o._extend(n,r)}else n=n||{},n.className=t,s=this._extend(n,r);return s.extend=function(n){if(i.isString(n)||n&&i.has(n,"className"))return e.Object.extend.apply(s,arguments);var r=[t].concat(e._.toArray(arguments));return e.Object.extend.apply(s,r)},e.Object._classMap[t]=s,s},e.Object._findUnsavedChildren=function(t,i,n){e._traverse(t,function(t){return t instanceof e.Object?(t._refreshCache(),t.dirty()&&i.push(t),void 0):t instanceof e.File?(t.url()||n.push(t),void 0):void 0})},e.Object._canBeSerializedAsValue=function(t){var n=!0;return t instanceof e.Object?n=!!t.id:i.isArray(t)?e._arrayEach(t,function(t){e.Object._canBeSerializedAsValue(t)||(n=!1)}):i.isObject(t)&&e._objectEach(t,function(t){e.Object._canBeSerializedAsValue(t)||(n=!1)}),n},e.Object._deepSaveAsync=function(t){var n=[],r=[];e.Object._findUnsavedChildren(t,n,r);var s=e.Promise.as();i.each(r,function(t){s=s.then(function(){return t.save()})});var o=i.uniq(n),a=i.uniq(o);return s.then(function(){return e.Promise._continueWhile(function(){return a.length>0},function(){var t=[],n=[];if(e._arrayEach(a,function(e){return t.length>20?(n.push(e),void 0):(e._canBeSerialized()?t.push(e):n.push(e),void 0)}),a=n,0===t.length)return e.Promise.error(new e.Error(e.Error.OTHER_CAUSE,"Tried to save a batch with a cycle."));var r=e.Promise.when(i.map(t,function(t){return t._allPreviousSaves||e.Promise.as()})),s=new e.Promise;return e._arrayEach(t,function(t){t._allPreviousSaves=s}),r._continueWith(function(){return e._request("batch",null,null,"POST",{requests:i.map(t,function(t){var e=t._getSaveJSON(),i="POST",n="/1/classes/"+t.className;return t.id&&(n=n+"/"+t.id,i="PUT"),t._startSave(),{method:i,path:n,body:e}})}).then(function(i,n,r){var s;return e._arrayEach(t,function(t,e){i[e].success?t._finishSave(t.parse(i[e].success,n,r)):(s=s||i[e].error,t._cancelSave())}),s?e.Promise.error(new e.Error(s.code,s.error)):void 0}).then(function(t){return s.resolve(t),t},function(t){return s.reject(t),e.Promise.error(t)})})})}).then(function(){return t})}}(this),function(t){t.AV=t.AV||{};var e=t.AV,i=e._;e.Role=e.Object.extend("_Role",{constructor:function(t,n){i.isString(t)&&n instanceof e.ACL?(e.Object.prototype.constructor.call(this,null,null),this.setName(t),this.setACL(n)):e.Object.prototype.constructor.call(this,t,n)},getName:function(){return this.get("name")},setName:function(t,e){return this.set("name",t,e)},getUsers:function(){return this.relation("users")},getRoles:function(){return this.relation("roles")},validate:function(t,n){if("name"in t&&t.name!==this.getName()){var r=t.name;if(this.id&&this.id!==t.objectId)return new e.Error(e.Error.OTHER_CAUSE,"A role's name can only be set before it has been saved.");if(!i.isString(r))return new e.Error(e.Error.OTHER_CAUSE,"A role's name must be a String.");if(!/^[0-9a-zA-Z\-_ ]+$/.test(r))return new e.Error(e.Error.OTHER_CAUSE,"A role's name can only contain alphanumeric characters, _, -, and spaces.")}return e.Object.prototype.validate?e.Object.prototype.validate.call(this,t,n):!1}})}(this),function(t){t.AV=t.AV||{};var e=t.AV,i=e._;e.Collection=function(t,e){e=e||{},e.comparator&&(this.comparator=e.comparator),e.model&&(this.model=e.model),e.query&&(this.query=e.query),this._reset(),this.initialize.apply(this,arguments),t&&this.reset(t,{silent:!0,parse:e.parse})},i.extend(e.Collection.prototype,e.Events,{model:e.Object,initialize:function(){},toJSON:function(){return this.map(function(t){return t.toJSON()})},add:function(t,n){var r,s,o,a,l,c,d={},u={};for(n=n||{},t=i.isArray(t)?t.slice():[t],r=0,o=t.length;o>r;r++){if(t[r]=this._prepareModel(t[r],n),a=t[r],!a)throw new Error("Can't add an invalid model to a collection");if(l=a.cid,d[l]||this._byCid[l])throw new Error("Duplicate cid: can't add the same model to a collection twice");if(c=a.id,!e._isNullOrUndefined(c)&&(u[c]||this._byId[c]))throw new Error("Duplicate id: can't add the same model to a collection twice");u[c]=a,d[l]=a}for(r=0;o>r;r++)(a=t[r]).on("all",this._onModelEvent,this),this._byCid[a.cid]=a,a.id&&(this._byId[a.id]=a);if(this.length+=o,s=e._isNullOrUndefined(n.at)?this.models.length:n.at,this.models.splice.apply(this.models,[s,0].concat(t)),this.comparator&&this.sort({silent:!0}),n.silent)return this;for(r=0,o=this.models.length;o>r;r++)a=this.models[r],d[a.cid]&&(n.index=r,a.trigger("add",a,this,n));return this},remove:function(t,e){var n,r,s,o;for(e=e||{},t=i.isArray(t)?t.slice():[t],n=0,r=t.length;r>n;n++)o=this.getByCid(t[n])||this.get(t[n]),o&&(delete this._byId[o.id],delete this._byCid[o.cid],s=this.indexOf(o),this.models.splice(s,1),this.length--,e.silent||(e.index=s,o.trigger("remove",o,this,e)),this._removeReference(o));return this},get:function(t){return t&&this._byId[t.id||t]},getByCid:function(t){return t&&this._byCid[t.cid||t]},at:function(t){return this.models[t]},sort:function(t){if(t=t||{},!this.comparator)throw new Error("Cannot sort a set without a comparator");var e=i.bind(this.comparator,this);return 1===this.comparator.length?this.models=this.sortBy(e):this.models.sort(e),t.silent||this.trigger("reset",this,t),this},pluck:function(t){return i.map(this.models,function(e){return e.get(t)})},reset:function(t,i){var n=this;return t=t||[],i=i||{},e._arrayEach(this.models,function(t){n._removeReference(t)}),this._reset(),this.add(t,{silent:!0,parse:i.parse}),i.silent||this.trigger("reset",this,i),this},fetch:function(t){t=i.clone(t)||{},void 0===t.parse&&(t.parse=!0);var n=this,r=this.query||new e.Query(this.model);return r.find().then(function(e){return t.add?n.add(e,t):n.reset(e,t),n})._thenRunCallbacks(t,this)},create:function(t,e){var n=this;if(e=e?i.clone(e):{},t=this._prepareModel(t,e),!t)return!1;e.wait||n.add(t,e);var r=e.success;return e.success=function(i,s){e.wait&&n.add(i,e),r?r(i,s):i.trigger("sync",t,s,e)},t.save(null,e),t},parse:function(t){return t},chain:function(){return i(this.models).chain()},_reset:function(){this.length=0,this.models=[],this._byId={},this._byCid={}},_prepareModel:function(t,i){if(t instanceof e.Object)t.collection||(t.collection=this);else{var n=t;i.collection=this,t=new this.model(n,i),t._validate(t.attributes,i)||(t=!1)}return t},_removeReference:function(t){this===t.collection&&delete t.collection,t.off("all",this._onModelEvent,this)},_onModelEvent:function(t,e,i,n){("add"!==t&&"remove"!==t||i===this)&&("destroy"===t&&this.remove(e,n),e&&"change:objectId"===t&&(delete this._byId[e.previous("objectId")],this._byId[e.id]=e),this.trigger.apply(this,arguments))}});var n=["forEach","each","map","reduce","reduceRight","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","sortBy","sortedIndex","toArray","size","first","initial","rest","last","without","indexOf","shuffle","lastIndexOf","isEmpty","groupBy"];e._arrayEach(n,function(t){e.Collection.prototype[t]=function(){return i[t].apply(i,[this.models].concat(i.toArray(arguments)))}}),e.Collection.extend=e._extend}(this),function(t){t.AV=t.AV||{};var e=t.AV,i=e._;e.View=function(t){this.cid=i.uniqueId("view"),this._configure(t||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()};var n=/^(\S+)\s*(.*)$/,r=["model","collection","el","id","attributes","className","tagName"];i.extend(e.View.prototype,e.Events,{tagName:"div",$:function(t){return this.$el.find(t)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this},make:function(t,i,n){var r=document.createElement(t);return i&&e.$(r).attr(i),n&&e.$(r).html(n),r},setElement:function(t,i){return this.$el=e.$(t),this.el=this.$el[0],i!==!1&&this.delegateEvents(),this},delegateEvents:function(t){if(t=t||e._getValue(this,"events")){this.undelegateEvents();var r=this;e._objectEach(t,function(e,s){if(i.isFunction(e)||(e=r[t[s]]),!e)throw new Error('Event "'+t[s]+'" does not exist');var o=s.match(n),a=o[1],l=o[2];e=i.bind(e,r),a+=".delegateEvents"+r.cid,""===l?r.$el.bind(a,e):r.$el.delegate(l,a,e)})}},undelegateEvents:function(){this.$el.unbind(".delegateEvents"+this.cid)
},_configure:function(t){this.options&&(t=i.extend({},this.options,t));var e=this;i.each(r,function(i){t[i]&&(e[i]=t[i])}),this.options=t},_ensureElement:function(){if(this.el)this.setElement(this.el,!1);else{var t=e._getValue(this,"attributes")||{};this.id&&(t.id=this.id),this.className&&(t["class"]=this.className),this.setElement(this.make(this.tagName,t),!1)}}}),e.View.extend=e._extend}(this),function(t){t.AV=t.AV||{};var e=t.AV,i=e._;e.User=e.Object.extend("_User",{_isCurrentUser:!1,_mergeMagicFields:function(t){t.sessionToken&&(this._sessionToken=t.sessionToken,delete t.sessionToken),e.User.__super__._mergeMagicFields.call(this,t)},_cleanupAuthData:function(){if(this.isCurrent()){var t=this.get("authData");t&&e._objectEach(this.get("authData"),function(e,i){t[i]||delete t[i]})}},_synchronizeAllAuthData:function(){var t=this.get("authData");if(t){var i=this;e._objectEach(this.get("authData"),function(t,e){i._synchronizeAuthData(e)})}},_synchronizeAuthData:function(t){if(this.isCurrent()){var n;i.isString(t)?(n=t,t=e.User._authProviders[n]):n=t.getAuthType();var r=this.get("authData");if(r&&t){var s=t.restoreAuthentication(r[n]);s||this._unlinkFrom(t)}}},_handleSaveResult:function(t){t&&(this._isCurrentUser=!0),this._cleanupAuthData(),this._synchronizeAllAuthData(),delete this._serverData.password,this._rebuildEstimatedDataForKey("password"),this._refreshCache(),(t||this.isCurrent())&&e.User._saveCurrentUser(this)},_linkWith:function(t,n){var r;if(i.isString(t)?(r=t,t=e.User._authProviders[t]):r=t.getAuthType(),i.has(n,"authData")){var s=this.get("authData")||{};s[r]=n.authData,this.set("authData",s);var o=i.clone(n)||{};return o.success=function(t){t._handleSaveResult(!0),n.success&&n.success.apply(this,arguments)},this.save({authData:s},o)}var a=this,l=new e.Promise;return t.authenticate({success:function(t,e){a._linkWith(t,{authData:e,success:n.success,error:n.error}).then(function(){l.resolve(a)})},error:function(t,e){n.error&&n.error(a,e),l.reject(e)}}),l},_unlinkFrom:function(t,n){var r;i.isString(t)?(r=t,t=e.User._authProviders[t]):r=t.getAuthType();var s=i.clone(n),o=this;return s.authData=null,s.success=function(){o._synchronizeAuthData(t),n.success&&n.success.apply(this,arguments)},this._linkWith(t,s)},_isLinked:function(t){var e;e=i.isString(t)?t:t.getAuthType();var n=this.get("authData")||{};return!!n[e]},_logOutWithAll:function(){var t=this.get("authData");if(t){var i=this;e._objectEach(this.get("authData"),function(t,e){i._logOutWith(e)})}},_logOutWith:function(t){this.isCurrent()&&(i.isString(t)&&(t=e.User._authProviders[t]),t&&t.deauthenticate&&t.deauthenticate())},signUp:function(t,n){var r;n=n||{};var s=t&&t.username||this.get("username");if(!s||""===s)return r=new e.Error(e.Error.OTHER_CAUSE,"Cannot sign up user with an empty name."),n&&n.error&&n.error(this,r),e.Promise.error(r);var o=t&&t.password||this.get("password");if(!o||""===o)return r=new e.Error(e.Error.OTHER_CAUSE,"Cannot sign up user with an empty password."),n&&n.error&&n.error(this,r),e.Promise.error(r);var a=i.clone(n);return a.success=function(t){t._handleSaveResult(!0),n.success&&n.success.apply(this,arguments)},this.save(t,a)},logIn:function(t){var i=this,n=e._request("login",null,null,"GET",this.toJSON());return n.then(function(t,e,n){var r=i.parse(t,e,n);return i._finishFetch(r),i._handleSaveResult(!0),i})._thenRunCallbacks(t,this)},save:function(t,n,r){var s,o;i.isObject(t)||i.isNull(t)||i.isUndefined(t)?(s=t,o=n):(s={},s[t]=n,o=r),o=o||{};var a=i.clone(o);return a.success=function(t){t._handleSaveResult(!1),o.success&&o.success.apply(this,arguments)},e.Object.prototype.save.call(this,s,a)},fetch:function(t){var n=t?i.clone(t):{};return n.success=function(e){e._handleSaveResult(!1),t&&t.success&&t.success.apply(this,arguments)},e.Object.prototype.fetch.call(this,n)},isCurrent:function(){return this._isCurrentUser},getUsername:function(){return this.get("username")},setUsername:function(t,e){return this.set("username",t,e)},setPassword:function(t,e){return this.set("password",t,e)},getEmail:function(){return this.get("email")},setEmail:function(t,e){return this.set("email",t,e)},authenticated:function(){return!!this._sessionToken&&e.User.current()&&e.User.current().id===this.id}},{_currentUser:null,_currentUserMatchesDisk:!1,_CURRENT_USER_KEY:"currentUser",_authProviders:{},signUp:function(t,i,n,r){n=n||{},n.username=t,n.password=i;var s=e.Object._create("_User");return s.signUp(n,r)},logIn:function(t,i,n){var r=e.Object._create("_User");return r._finishFetch({username:t,password:i}),r.logIn(n)},logOut:function(){null!==e.User._currentUser&&(e.User._currentUser._logOutWithAll(),e.User._currentUser._isCurrentUser=!1),e.User._currentUserMatchesDisk=!0,e.User._currentUser=null,e.localStorage.removeItem(e._getAVPath(e.User._CURRENT_USER_KEY))},requestPasswordReset:function(t,i){var n={email:t},r=e._request("requestPasswordReset",null,null,"POST",n);return r._thenRunCallbacks(i)},current:function(){if(e.User._currentUser)return e.User._currentUser;if(e.User._currentUserMatchesDisk)return e.User._currentUser;e.User._currentUserMatchesDisk=!0;var t=e.localStorage.getItem(e._getAVPath(e.User._CURRENT_USER_KEY));if(!t)return null;e.User._currentUser=e.Object._create("_User"),e.User._currentUser._isCurrentUser=!0;var i=JSON.parse(t);return e.User._currentUser.id=i._id,delete i._id,e.User._currentUser._sessionToken=i._sessionToken,delete i._sessionToken,e.User._currentUser.set(i),e.User._currentUser._synchronizeAllAuthData(),e.User._currentUser._refreshCache(),e.User._currentUser._opSetQueue=[{}],e.User._currentUser},_saveCurrentUser:function(t){e.User._currentUser!==t&&e.User.logOut(),t._isCurrentUser=!0,e.User._currentUser=t,e.User._currentUserMatchesDisk=!0;var i=t.toJSON();i._id=t.id,i._sessionToken=t._sessionToken,e.localStorage.setItem(e._getAVPath(e.User._CURRENT_USER_KEY),JSON.stringify(i))},_registerAuthenticationProvider:function(t){e.User._authProviders[t.getAuthType()]=t,e.User.current()&&e.User.current()._synchronizeAuthData(t.getAuthType())},_logInWith:function(t,i){var n=e.Object._create("_User");return n._linkWith(t,i)}})}(this),function(t){t.AV=t.AV||{};var e=t.AV,i=e._;e.Query=function(t){i.isString(t)&&(t=e.Object._getSubclass(t)),this.objectClass=t,this.className=t.prototype.className,this._where={},this._include=[],this._limit=-1,this._skip=0,this._extraOptions={}},e.Query.or=function(){var t=i.toArray(arguments),n=null;e._arrayEach(t,function(t){if(i.isNull(n)&&(n=t.className),n!==t.className)throw"All queries must be for the same class"});var r=new e.Query(n);return r._orQuery(t),r},e.Query.prototype={get:function(t,i){var n=this;return n.equalTo("objectId",t),n.first().then(function(t){if(t)return t;var i=new e.Error(e.Error.OBJECT_NOT_FOUND,"Object not found.");return e.Promise.error(i)})._thenRunCallbacks(i,null)},toJSON:function(){var t={where:this._where};return this._include.length>0&&(t.include=this._include.join(",")),this._select&&(t.keys=this._select.join(",")),this._limit>=0&&(t.limit=this._limit),this._skip>0&&(t.skip=this._skip),void 0!==this._order&&(t.order=this._order),e._objectEach(this._extraOptions,function(e,i){t[i]=e}),t},find:function(t){var n=this,r=e._request("classes",this.className,null,"GET",this.toJSON());return r.then(function(t){return i.map(t.results,function(i){var r;return r=t.className?new e.Object(t.className):new n.objectClass,r._finishFetch(i,!0),r})})._thenRunCallbacks(t)},destroyAll:function(t){var i=this;return i.find().then(function(t){return e.Object.destroyAll(t)})._thenRunCallbacks(t)},count:function(t){var i=this.toJSON();i.limit=0,i.count=1;var n=e._request("classes",this.className,null,"GET",i);return n.then(function(t){return t.count})._thenRunCallbacks(t)},first:function(t){var n=this,r=this.toJSON();r.limit=1;var s=e._request("classes",this.className,null,"GET",r);return s.then(function(t){return i.map(t.results,function(t){var e=new n.objectClass;return e._finishFetch(t,!0),e})[0]})._thenRunCallbacks(t)},collection:function(t,n){return n=n||{},new e.Collection(t,i.extend(n,{model:this.objectClass,query:this}))},skip:function(t){return this._skip=t,this},limit:function(t){return this._limit=t,this},equalTo:function(t,i){return this._where[t]=e._encode(i),this},_addCondition:function(t,i,n){return this._where[t]||(this._where[t]={}),this._where[t][i]=e._encode(n),this},notEqualTo:function(t,e){return this._addCondition(t,"$ne",e),this},lessThan:function(t,e){return this._addCondition(t,"$lt",e),this},greaterThan:function(t,e){return this._addCondition(t,"$gt",e),this},lessThanOrEqualTo:function(t,e){return this._addCondition(t,"$lte",e),this},greaterThanOrEqualTo:function(t,e){return this._addCondition(t,"$gte",e),this},containedIn:function(t,e){return this._addCondition(t,"$in",e),this},notContainedIn:function(t,e){return this._addCondition(t,"$nin",e),this},containsAll:function(t,e){return this._addCondition(t,"$all",e),this},exists:function(t){return this._addCondition(t,"$exists",!0),this},doesNotExist:function(t){return this._addCondition(t,"$exists",!1),this},matches:function(t,e,i){return this._addCondition(t,"$regex",e),i||(i=""),e.ignoreCase&&(i+="i"),e.multiline&&(i+="m"),i&&i.length&&this._addCondition(t,"$options",i),this},matchesQuery:function(t,e){var i=e.toJSON();return i.className=e.className,this._addCondition(t,"$inQuery",i),this},doesNotMatchQuery:function(t,e){var i=e.toJSON();return i.className=e.className,this._addCondition(t,"$notInQuery",i),this},matchesKeyInQuery:function(t,e,i){var n=i.toJSON();return n.className=i.className,this._addCondition(t,"$select",{key:e,query:n}),this},doesNotMatchKeyInQuery:function(t,e,i){var n=i.toJSON();return n.className=i.className,this._addCondition(t,"$dontSelect",{key:e,query:n}),this},_orQuery:function(t){var e=i.map(t,function(t){return t.toJSON().where});return this._where.$or=e,this},_quote:function(t){return"\\Q"+t.replace("\\E","\\E\\\\E\\Q")+"\\E"},contains:function(t,e){return this._addCondition(t,"$regex",this._quote(e)),this},startsWith:function(t,e){return this._addCondition(t,"$regex","^"+this._quote(e)),this},endsWith:function(t,e){return this._addCondition(t,"$regex",this._quote(e)+"$"),this},ascending:function(t){return this._order=t,this},descending:function(t){return this._order="-"+t,this},near:function(t,i){return i instanceof e.GeoPoint||(i=new e.GeoPoint(i)),this._addCondition(t,"$nearSphere",i),this},withinRadians:function(t,e,i){return this.near(t,e),this._addCondition(t,"$maxDistance",i),this},withinMiles:function(t,e,i){return this.withinRadians(t,e,i/3958.8)},withinKilometers:function(t,e,i){return this.withinRadians(t,e,i/6371)},withinGeoBox:function(t,i,n){return i instanceof e.GeoPoint||(i=new e.GeoPoint(i)),n instanceof e.GeoPoint||(n=new e.GeoPoint(n)),this._addCondition(t,"$within",{$box:[i,n]}),this},include:function(){var t=this;return e._arrayEach(arguments,function(e){i.isArray(e)?t._include=t._include.concat(e):t._include.push(e)}),this},select:function(){var t=this;return this._select=this._select||[],e._arrayEach(arguments,function(e){i.isArray(e)?t._select=t._select.concat(e):t._select.push(e)}),this},each:function(t,n){if(n=n||{},this._order||this._skip||this._limit>=0){var r="Cannot iterate on a query with sort, skip, or limit.";return e.Promise.error(r)._thenRunCallbacks(n)}new e.Promise;var s=new e.Query(this.objectClass);s._limit=n.batchSize||100,s._where=i.clone(this._where),s._include=i.clone(this._include),s.ascending("objectId");var o=!1;return e.Promise._continueWhile(function(){return!o},function(){return s.find().then(function(i){var n=e.Promise.as();return e._.each(i,function(e){n=n.then(function(){return t(e)})}),n.then(function(){i.length>=s._limit?s.greaterThan("objectId",i[i.length-1].id):o=!0})})})._thenRunCallbacks(n)}}}(this),function(t){t.AV=t.AV||{};var e,i,n=t.AV,r=n._,s=!1,o={authenticate:function(t){var i=this;FB.login(function(e){e.authResponse?t.success&&t.success(i,{id:e.authResponse.userID,access_token:e.authResponse.accessToken,expiration_date:new Date(1e3*e.authResponse.expiresIn+(new Date).getTime()).toJSON()}):t.error&&t.error(i,e)},{scope:e})},restoreAuthentication:function(t){if(t){var e={userID:t.id,accessToken:t.access_token,expiresIn:(n._parseDate(t.expiration_date).getTime()-(new Date).getTime())/1e3},s=r.clone(i);s.authResponse=e,s.status=!1,FB.init(s)}return!0},getAuthType:function(){return"facebook"},deauthenticate:function(){this.restoreAuthentication(null),FB.logout()}};n.FacebookUtils={init:function(t){if("undefined"==typeof FB)throw"The Facebook JavaScript SDK must be loaded before calling init.";if(i=r.clone(t)||{},i.status&&"undefined"!=typeof console){var e=console.warn||console.log||function(){};e.call(console,"The 'status' flag passed into FB.init, when set to true, can interfere with AV Facebook integration, so it has been suppressed. Please call FB.getLoginStatus() explicitly if you require this behavior.")}i.status=!1,FB.init(i),n.User._registerAuthenticationProvider(o),s=!0},isLinked:function(t){return t._isLinked("facebook")},logIn:function(t,i){if(!t||r.isString(t)){if(!s)throw"You must initialize FacebookUtils before calling logIn.";return e=t,n.User._logInWith("facebook",i)}var o=r.clone(i)||{};return o.authData=t,n.User._logInWith("facebook",o)},link:function(t,i,n){if(!i||r.isString(i)){if(!s)throw"You must initialize FacebookUtils before calling link.";return e=i,t._linkWith("facebook",n)}var o=r.clone(n)||{};return o.authData=i,t._linkWith("facebook",o)},unlink:function(t,e){if(!s)throw"You must initialize FacebookUtils before calling unlink.";return t._unlinkFrom("facebook",e)}}}(this),function(t){t.AV=t.AV||{};var e=t.AV,i=e._;e.History=function(){this.handlers=[],i.bindAll(this,"checkUrl")};var n=/^[#\/]/,r=/msie [\w.]+/;e.History.started=!1,i.extend(e.History.prototype,e.Events,{interval:50,getHash:function(t){var e=t?t.location:window.location,i=e.href.match(/#(.*)$/);return i?i[1]:""},getFragment:function(t,i){if(e._isNullOrUndefined(t))if(this._hasPushState||i){t=window.location.pathname;var r=window.location.search;r&&(t+=r)}else t=this.getHash();return t.indexOf(this.options.root)||(t=t.substr(this.options.root.length)),t.replace(n,"")},start:function(t){if(e.History.started)throw new Error("AV.history has already been started");e.History.started=!0,this.options=i.extend({},{root:"/"},this.options,t),this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&window.history&&window.history.pushState);var s=this.getFragment(),o=document.documentMode,a=r.exec(navigator.userAgent.toLowerCase())&&(!o||7>=o);a&&(this.iframe=e.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(s)),this._hasPushState?e.$(window).bind("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!a?e.$(window).bind("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=window.setInterval(this.checkUrl,this.interval)),this.fragment=s;var l=window.location,c=l.pathname===this.options.root;return this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!c?(this.fragment=this.getFragment(null,!0),window.location.replace(this.options.root+"#"+this.fragment),!0):(this._wantsPushState&&this._hasPushState&&c&&l.hash&&(this.fragment=this.getHash().replace(n,""),window.history.replaceState({},document.title,l.protocol+"//"+l.host+this.options.root+this.fragment)),this.options.silent?void 0:this.loadUrl())},stop:function(){e.$(window).unbind("popstate",this.checkUrl).unbind("hashchange",this.checkUrl),window.clearInterval(this._checkUrlInterval),e.History.started=!1},route:function(t,e){this.handlers.unshift({route:t,callback:e})},checkUrl:function(){var t=this.getFragment();return t===this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe))),t===this.fragment?!1:(this.iframe&&this.navigate(t),this.loadUrl()||this.loadUrl(this.getHash()),void 0)},loadUrl:function(t){var e=this.fragment=this.getFragment(t),n=i.any(this.handlers,function(t){return t.route.test(e)?(t.callback(e),!0):void 0});return n},navigate:function(t,i){if(!e.History.started)return!1;i&&i!==!0||(i={trigger:i});var r=(t||"").replace(n,"");if(this.fragment!==r){if(this._hasPushState){0!==r.indexOf(this.options.root)&&(r=this.options.root+r),this.fragment=r;var s=i.replace?"replaceState":"pushState";window.history[s]({},document.title,r)}else this._wantsHashChange?(this.fragment=r,this._updateHash(window.location,r,i.replace),this.iframe&&r!==this.getFragment(this.getHash(this.iframe))&&(i.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,r,i.replace))):window.location.assign(this.options.root+t);i.trigger&&this.loadUrl(t)}},_updateHash:function(t,e,i){if(i){var n=t.toString().replace(/(javascript:|#).*$/,"");t.replace(n+"#"+e)}else t.hash=e}})}(this),function(t){t.AV=t.AV||{};var e=t.AV,i=e._;e.Router=function(t){t=t||{},t.routes&&(this.routes=t.routes),this._bindRoutes(),this.initialize.apply(this,arguments)};var n=/:\w+/g,r=/\*\w+/g,s=/[\-\[\]{}()+?.,\\\^\$\|#\s]/g;i.extend(e.Router.prototype,e.Events,{initialize:function(){},route:function(t,n,r){return e.history=e.history||new e.History,i.isRegExp(t)||(t=this._routeToRegExp(t)),r||(r=this[n]),e.history.route(t,i.bind(function(i){var s=this._extractParameters(t,i);r&&r.apply(this,s),this.trigger.apply(this,["route:"+n].concat(s)),e.history.trigger("route",this,n,s)},this)),this},navigate:function(t,i){e.history.navigate(t,i)},_bindRoutes:function(){if(this.routes){var t=[];for(var e in this.routes)this.routes.hasOwnProperty(e)&&t.unshift([e,this.routes[e]]);for(var i=0,n=t.length;n>i;i++)this.route(t[i][0],t[i][1],this[t[i][1]])}},_routeToRegExp:function(t){return t=t.replace(s,"\\$&").replace(n,"([^/]+)").replace(r,"(.*?)"),new RegExp("^"+t+"$")},_extractParameters:function(t,e){return t.exec(e).slice(1)}}),e.Router.extend=e._extend}(this),function(t){t.AV=t.AV||{};var e=t.AV,i=e._;e.Cloud=e.Cloud||{},i.extend(e.Cloud,{run:function(t,i,n){var r=e._request("functions",t,null,"POST",e._encode(i,null,!0));return r.then(function(t){return e._decode(null,t).result})._thenRunCallbacks(n)}})}(this),function(t){t.AV=t.AV||{};var e=t.AV;e.Installation=e.Object.extend("_Installation"),e.Push=e.Push||{},e.Push.send=function(t,i){if(t.where&&(t.where=t.where.toJSON().where),t.push_time&&(t.push_time=t.push_time.toJSON()),t.expiration_time&&(t.expiration_time=t.expiration_time.toJSON()),t.expiration_time&&t.expiration_time_interval)throw"Both expiration_time and expiration_time_interval can't be set";var n=e._request("push",null,null,"POST",t);return n._thenRunCallbacks(i)}}(this);